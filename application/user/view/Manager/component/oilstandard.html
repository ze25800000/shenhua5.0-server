<div class="col-md-12">
    <form role="form" class="uploadForm">
        <div class="form-group">
            <label for="excel" class="col-md-3">上传润滑标准</label>
            <input class="col-md-3" type="file" id="excel" name="excel"/>
            <a href="javascript:void (0)"
               class="btn btn-default col-md-2 upload_excel"
               data-param="exceltype=oilstandard">上传
            </a>
        </div>
    </form>
</div>
<div class="row clearfix">
    <div class="col-md-12 column">
        <div class="row clearfix">
            <div class="col-md-2 column">
                <ul class="list-group" id="equ_list">
                </ul>
            </div>
            <div class="col-md-10 column">
                <div class="tabbable" id="tabs-914403">
                    <div class="tab-content" id="oil-standard-list">
                        <div class="tab-pane active" id="pane">
                            <p>
                                I'm in Section 1.
                            </p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script id="OilStandardTemplate" type="text/html">
    <div class="tab-pane" id="panel-${equ_no}">
        <table class="table">
            <thead>
            <tr>
                <th>
                    设备编号
                </th>
                <th>
                    润滑点编号
                </th>
                <th>
                    润滑点名称
                </th>
                <th>
                    物料编号
                </th>
                <th>
                    用量
                </th>
                <th>
                    单位
                </th>
                <th>
                    首保周期
                </th>
                <th>
                    最长更换周期
                </th>
                <th>
                    油脂采样间隔
                </th>
            </tr>
            </thead>
            <tbody>
            {{if list}}
            <tr>
                <td>
                    ${equ_no}
                </td>
                <td>
                    ${equ_oil_no}
                </td>
                <td>
                    ${oil_name}
                </td>
                <td>
                    ${oil_no}
                </td>
                <td>
                    ${quantity}
                </td>
                <td>
                    ${unit}
                </td>
                <td>
                    ${first_period}
                </td>
                <td>
                    ${period}
                </td>
                <td>
                    ${interval}
                </td>
            </tr>
            {{/if}}
            </tbody>
        </table>
    </div>
</script>
<script>
    $(function () {
        $(document).on('click', '.standard', function () {
            var equMarkup = '<li class="list-group-item"><a href="#panel-${equ_no}" data-toggle="tab" class="get_oil_list" data-equ_no="${equ_no}">${equ_name}</a></li>';
            $.template('equTemplate', equMarkup);
            window.base.getEquipmentList(function (list) {
                $.tmpl('equTemplate', list).appendTo("#equ_list");
                $('#equ_list').children('li:first').addClass('active');
            });
        });
        $(document).on('click', '.get_oil_list', function () {
            var OilStandardMarkup = $('#OilStandardTemplate')[0],
                equ_no = $(this).data('equ_no');
            $.template('OilStandardTemplate', OilStandardMarkup);
            window.base.getOilStandardList(equ_no, function (list) {
                console.log(list);
                $.tmpl('OilStandardTemplate', list).appendTo("#oil-standard-list")
            });
        });

        $(document).on('click', '.upload_excel', function () {
            var param = $(this).data('param');
            var params = {
                url: 'document/oil/upload?' + param + '&XDEBUG_SESSION_START=12092',
                data: new FormData($(this).parent().parent()[0]),
                sCallback: function (data) {
                    alert('上传成功');
                    console.log(data);
                    //                    window.location.reload();
                },
                eCallback: function (err) {
                    alert(err.msg);
                }
            };
            window.base.uploadFile(params);
        });
        $(document).on('click', '.del_btn', function () {
            var equ_no = $(this).data('equ_no');
            $('#delete_equ').click(function () {
                var params = {
                    url: 'document/oilstandard/delete_equ/' + equ_no + '?XDEBUG_SESSION_START=10628',
                    type: 'delete',
                    sCallback: function (data) {
                        window.location.reload();
                    },
                    eCallback: function (err) {
                        alert(err.msg);
                    }
                };
                window.base.getData(params);
            });
        });
    });
</script>