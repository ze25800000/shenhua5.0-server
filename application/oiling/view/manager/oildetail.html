<?php require(APP_PATH.'/oiling/view/manager/common/header.html');?>
<div id="container">
    <div id="hd">
        <div class="hd-wrap ue-clear">
            <div class="top-light"></div>
            <h1 class="logo"></h1>
            <div class="login-info ue-clear">
                <div class="welcome ue-clear">欢迎您,&nbsp;*{$account} <a href="/user/center">个人中心</a></div>
            </div>
            <div class="toolbar ue-clear">
                <a href="/" class="home-btn">首页</a>
                <a href="javascript:;" class="quit-btn exit"></a>
            </div>
        </div>
    </div>
    <div id="bd">
        <div class="wrap ue-clear">
            <div class="sidebar">
                <h2 class="sidebar-header"><p>功能导航</p></h2>
                <ul class="nav">
                    <li class="office">
                        <div class="nav-header"><a href="standard" class="ue-clear"><span>设备润滑标准</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="gongwen">
                        <div class="nav-header"><a href="info" class="ue-clear"><span>润滑提示与记录</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="nav-info">
                        <div class="nav-header"><a href="analysis" class="ue-clear"><span>油脂化验指标分析</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="konwledge current">
                        <div class="nav-header"><a href="oildetail" class="ue-clear"><span>润滑保养成本管理</span><i
                                class="icon"></i></a></div>
                    </li>
                </ul>
            </div>
            <div class="content">
                <div class="title">
                    <h2>润滑保养成本管理</h2>
                    *{if condition="$scope>=18"}
                    <div class="temp-btn-group">
                        下载模板：
                        <a style="width: 160px;" class="excel-temp-btn"
                           href="/download/template?exceltype=oildetail">润滑保养成本管理excel模板</a>
                    </div>
                    *{/if}
                </div>
                *{if condition="$scope>=18"}
                <div class="title">
                    <div class="uploader orange oildetail">
                        <form>
                            <span>批量上传润滑保养成本管理：</span>
                            <a href="javascript:;" class="a-upload">
                                <input type="file" name="excel" id=""><span class="showFileName">点击这里上传文件</span>
                            </a>
                            <input type="button" name="file" data-param="exceltype=oildetail"
                                   class="button upload" value="上传"/>
                        </form>
                    </div>
                </div>
                *{/if}
                <div class="query">
                    <div class="query-conditions ue-clear">
                        <div class="conditions time ue-clear">
                            <label>时&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;间：</label>
                            <div class="time-select">
                                <input id="monthly1" type="text" placeholder="开始时间">
                                <i class="icon"></i>
                            </div>
                            <span class="line">-</span>
                            <div class="time-select">
                                <input id="monthly2" type="text"
                                       placeholder="结束时间">
                                <i class="icon"></i>
                            </div>
                        </div>
                        <div class="query-btn ue-clear">
                            <a href="javascript:;" class="confirm cost-confirm">查询</a>
                        </div>
                    </div>
                </div>
                <div class="table-box">
                    <div class="scroll-box" style="overflow: hidden;overflow-y: auto">
                        <table>
                            <thead>
                            <tr>

                                <th class="process">物料编号</th>
                                <th class="process">油品名称</th>
                                <th class="process">物料描述</th>
                                <th class="process">单位</th>
                                <th class="process">单价(元)</th>
                                <th class="process">用量</th>
                                <th class="process">总计(元)</th>
                                <th class="operate">操作</th>
                            </tr>
                            </thead>
                            <tbody id="costTbody">

                            </tbody>
                            <script type="text/html" id="costTemplate">
                                {{each data}}
                                <tr>
                                    <td class="process">${$value.oil_no}</td>
                                    <td class="process">${$value.oil_name}</td>
                                    <td class="process">${$value.detail}</td>
                                    <td class="process">${$value.unit}</td>
                                    <td class="process">${$value.price}</td>
                                    <td class="process">${$value.how_much}</td>
                                    <td class="process">${$value.total}</td>
                                    <td class="operate table-operate">
                                        <a class="edit" href="javascript:;">编辑</a>
                                        <a class="del" href="javascript:;">删除</a>
                                    </td>
                                </tr>
                                {{/each}}
                            </script>
                        </table>
                    </div>
                </div>

            </div>
        </div>
        <div id="ft" class="ue-clear">
            <div class="ft-left">
                <span>神华集团</span>
                <em>设备润滑管理系统</em>
            </div>
            <div class="ft-right">
                <span>非同科技</span>
                <em>2017</em>
            </div>
        </div>
    </div>
</div>
<?php require(APP_PATH.'/oiling/view/manager/common/exitDialog.html');?>
<?php require(APP_PATH.'/oiling/view/manager/common/footer.html');?>
<script src="__JS__/jquery.monthpicker.js"></script>
<script>
    $(function () {
        var scrollHeight = $(document).height() - $('.scroll-box').offset().top - 27;
        $('.scroll-box').css('height', scrollHeight);

        $('#monthpicker').monthpicker({
            years: [2015, 2014, 2013, 2012, 2011],
            topOffset: 6,
            onMonthSelect: function (m, y) {
                console.log('Month: ' + m + ', year: ' + y);
            }
        });
        $('#monthly1').val(new Date().getFullYear() + '-' + '01');
        $('#monthly2').val(new Date().getFullYear() + '-' + 12);
        $('#monthly1').monthpicker({
            years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
            topOffset: 1
        });
        $('#monthly2').monthpicker({
            years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
            topOffset: 1
        });
        costList();

        function costList() {
            var before = (new Date($('#monthly1').val()).getTime()) / 1000;
            var after = (new Date($('#monthly2').val()).getTime()) / 1000;
            if (before >= after) {
                return false;
            }
            var params = {
                url: '/oiling/oildetail/costlist/' + before + '/' + after + '',
                sCallback: function (list) {
                    console.log(list);
                    $(document).find('#costTbody').html();
                    $('#costTemplate').tmpl(list).replaceAll('#costTbody');
                    $(document).find('tr:odd').css("backgroundColor", "#eff6fa");
                }
            };
            window.base.getData(params);
        }

        $('.cost-confirm').click(function () {
            costList();
        });
    });
</script>