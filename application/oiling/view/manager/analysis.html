<?php require(APP_PATH.'/oiling/view/manager/common/header.html');?>
<div id="container">
    <div id="hd">
        <div class="hd-wrap ue-clear">
            <div class="top-light"></div>
            <h1 class="logo"></h1>
            <div class="login-info ue-clear">
                <div class="welcome ue-clear">欢迎您,<a style="color: #fff;" href="/user/center">&nbsp;*{$account}</a>
                </div>
            </div>
            <div class="toolbar ue-clear">
                <a href="/" class="home-btn">首页</a>
                <a href="javascript:;" class="quit-btn exit"></a>
            </div>
        </div>
    </div>
    <div id="bd">
        <div class="wrap ue-clear">
            <div class="sidebar">
                <h2 class="sidebar-header"><p>功能导航</p></h2>
                <ul class="nav">
                    <li class="office">
                        <div class="nav-header"><a href="standard" class="ue-clear"><span>设备润滑标准</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="gongwen">
                        <div class="nav-header"><a href="info" class="ue-clear"><span>润滑提示与记录</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="nav-info current">
                        <div class="nav-header"><a href="analysis" class="ue-clear"><span>油脂化验指标分析</span><i
                                class="icon"></i></a></div>
                    </li>
                    <li class="konwledge">
                        <div class="nav-header"><a href="oildetail" class="ue-clear"><span>润滑保养成本管理</span><i
                                class="icon"></i></a></div>
                    </li>
                </ul>
            </div>
            <div class="content">
                <div class="title">
                    <h2>油脂化验指标分析</h2>
                    *{if condition="$scope>=18"}
                    <div class="temp-btn-group">
                        下载模板：
                        <a style="width: 160px;" class="excel-temp-btn"
                           href="info/download/template?exceltype=oilanalysis">油脂化验指标分析excel模板</a>
                    </div>
                    *{/if}
                </div>
                *{if condition="$scope>=18"}
                <div class="title">
                    <div class="check-content">
                        <span class="select-all">全选:</span>
                        <input class="check-all" type="checkbox">
                        <span class="check-info">下载选中的油脂指标分析记录</span>
                        <a href="javascript:;" class="check-download">下载</a>
                    </div>
                    <div class="uploader orange analysis">
                        <form>
                            <span>批量上传油脂化验指标分析：</span>
                            <a href="javascript:;" class="a-upload">
                                <input type="file" name="excel" id=""><span class="showFileName">点击这里上传文件</span>
                            </a>
                            <input type="button" name="file" data-param="exceltype=oilanalysis"
                                   class="button upload" value="上传"/>
                        </form>
                    </div>
                </div>
                *{/if}
                <div class="table-box">
                    <div class="scroll-box" style="overflow: hidden;overflow-y: auto">
                        <table>
                            <thead>
                            <tr>
                                <th class="num">
                                    选择
                                </th>
                                <th class="time">润滑点（全称）</th>
                                <th class="process">采样日期</th>
                                <th class="process">运行时长</th>
                                <th class="process">物料编号</th>
                                <th class="process">油品名称</th>
                                <th class="num">Fe</th>
                                <th class="num">Cu</th>
                                <th class="num">Al</th>
                                <th class="num">Si</th>
                                <th class="num">Na</th>
                                <th class="num">PQ</th>
                                <th class="num">粘度</th>
                                <th class="process">油脂状态</th>
                                <th class="process">处理意见</th>
                                <th class="operate">操作</th>
                            </tr>
                            </thead>
                            <tbody id="analysisBody">
                            *{foreach $OilList as $v}
                            <tr *{if condition="$v.advise==0" } style="background-color: #fffdcf" *{/if}>
                            <td class="num"><input *{if condition="$v.advise==0" }checked*{/if} type="checkbox"
                                data-id="*{$v.id}">
                            </td>
                            <td class="time edit-item" data-id="*{$v.id}" data-key="equ_oil_name">*{$v.equ_oil_name}</td>
                            <td class="time edit-item" data-id="*{$v.id}" data-key="sampling_time">*{$v.sampling_time}</td>
                            <td class="process">*{$v.work_hour}</td>
                            <td class="process">*{$v.oil_no}</td>
                            <td class="process">*{$v.oil_name}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="Fe" *{if condition="$v.Fe>$c.Fe" } style="color: red;font-weight: 600;" *{/if}>*{$v.Fe}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="Cu" *{if condition="$v.Cu>$c.Cu" } style="color: red;font-weight: 600;" *{/if}>*{$v.Cu}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="Al" *{if condition="$v.Al>$c.Al" } style="color: red;font-weight: 600;" *{/if}>*{$v.Al}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="Si" *{if condition="$v.Si>$c.Si" } style="color: red;font-weight: 600;" *{/if}>*{$v.Si}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="Na" *{if condition="$v.Na>$c.Na" } style="color: red;font-weight: 600;" *{/if}>*{$v.Na}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="pq" *{if condition="$v.pq>$c.pq" } style="color: red;font-weight: 600;" *{/if}>*{$v.pq}</td>
                            <td class="num edit-item" data-id="*{$v.id}" data-key="viscosity" *{if
                                condition="$v.viscosity<$c.viscosity_min OR $v.viscosity>$c.viscosity_max" }
                                style="color: red;font-weight: 600;" *{/if}>*{$v.viscosity}</td>
                            <td class="process">*{$v.oil_status?$v.oil_status:'良好'}</td>
                            <td class="process">*{$v.advise?'正常使用':'建议更换'}</td>
                            <td class="operate table-operate">
                                <a href="equdetail/*{$v.equ_key_no}" class="check" target="_blank">查看</a>
                                <a href="javascript:;" class="del" data-id="*{$v.id}">删除</a>
                            </td>
                            </tr>
                            *{/foreach}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="ft" class="ue-clear">
        <div class="ft-left">
            <span>神华集团</span>
            <em>设备润滑管理系统</em>
        </div>
        <div class="ft-right">
            <span>非同科技</span>
            <em>2017</em>
        </div>
    </div>
</div>
<div class="tanchuang">
    <div class="hintl">
        <div class="hintl-in1">
            <div class="hintl1"></div>
            <div class="hintl2">油脂化验指标分析删除窗口</div>
            <div class="hint3"></div>
        </div>
        <div class="hintl-in2">是否删除该油脂化验指标分析？</div>
        <a class="hintl-in3 confirm-del" href="javascript:;">是</a>
        <a class="hintl-in4" href="javascript:;">否</a>
    </div>
</div>
<?php require(APP_PATH.'/oiling/view/manager/common/exitDialog.html');?>
<?php require(APP_PATH.'/oiling/view/manager/common/footer.html');?>
<script>
    $('.upload').click(function () {
        var param = $(this).data('param'),
            params = {
                url: 'oiling/upload?' + param + '&XDEBUG_SESSION_START=14188',
                data: new FormData($(this).parent()[0]),
                sCallback: function () {
                    alert('上传成功');
                }
            };
        window.base.uploadFile(params);
    });
    $('.check-download').click(function () {
        var ids = [];
        $('#analysisBody input').each(function (index, value) {
            if ($(value).attr('checked')) {
                ids.push($(value).data('id'));
            }
        });
        var idsStr = ids.join(','),
            url = '/oiling/analysis/download/' + idsStr + '?exceltype=oilanalysis&XDEBUG_SESSION_START=14188';
        if (ids.length != 0) {
            window.location.href = url;
        }
    });
    $('.del').click(function () {
        $('.hintl').show(100);
        var id = $(this).data('id'),
            _this = $(this);
        $('.confirm-del').click(function () {
            var params = {
                url: '/oiling/analysis/del/' + id,
                type: 'delete',
                sCallback: function () {
                    _this.parent().parent().hide(200).remove();
                }
            };
            window.base.getData(params);
        });
    });
    //编辑润滑标准条目信息
    $(document).on('dblclick', '.edit-item', function (e) {
        var _this = $(this),
            oldVal = _this.html(),
            url = '/oiling/analysis/edititem/';
        oldVal = oldVal.replace(/(^\s*)|(\s*$)/g, "");
        var long = oldVal.length * 12;
        if (!/input/.test(oldVal)) {
            _this.html('<input type="text" value="' + oldVal + '" style="width: ' + long + 'px">');
        }
        var input = _this.find('input');
        input.select();
        window.base.editItemByDblClick(_this, input, oldVal, url, function () {
            window.location.reload();
        });
    });
</script>